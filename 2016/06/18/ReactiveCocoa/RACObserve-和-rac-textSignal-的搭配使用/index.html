<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>RACObserve 和 rac_textSignal 的搭配使用 | Kenny 肉桂的主页</title>
  <meta name="author" content="桂庆">
  
  <meta name="description" content="Kenny 肉桂的主页 记录自己的进步">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="RACObserve 和 rac_textSignal 的搭配使用"/>
  <meta property="og:site_name" content="Kenny 肉桂的主页"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Kenny 肉桂的主页" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Kenny 肉桂的主页</a></h1>
  <h2><a href="/">记录自己的进步</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">主页</a></li>
    
      <li><a href="/about">关于我</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2016-06-18T15:28:19.000Z"><a href="/2016/06/18/ReactiveCocoa/RACObserve-和-rac-textSignal-的搭配使用/">2016-06-18</a></time>
      
      
  
    <h1 class="title">RACObserve 和 rac_textSignal 的搭配使用</h1>
  

    </header>
    <div class="entry">
      
        <p>项目中有个小需求,文本框与按钮绑定.当文本框内容符合规则的时候,按钮才会可用.把判定条件修改一下,代码如下:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">     RAC(self.loginButton,enabled)  = [self.textFiled.rac_textSignal  map:^id(NSString *value) &#123;&#10;        return @(value.length&#62;3);&#10;    &#125;];&#10; ``` &#10;&#20294;&#26159;&#22914;&#26524;&#22312;&#21457;&#36865;&#35831;&#27714;&#20043;&#21518;,&#36890;&#36807;&#20195;&#30721;&#28165;&#38500;&#20102;&#25991;&#26412;&#26694;&#30340;&#20869;&#23481;,&#25353;&#38062;&#24182;&#19981;&#20250;&#25913;&#21464;&#29366;&#24577;. &#10;&#10; &#24819;&#21040;&#20102;, &#24212;&#35813;&#26159;&#36825;&#20010; `rac_textSignal` &#20986;&#29616;&#38382;&#39064;&#20102;.&#10; &#30475;&#19968;&#19979;&#23427;&#30340;&#23454;&#29616;:</span><br></pre></td></tr></table></figure>
<ul>
<li>(RACSignal *)rac_textSignal {<br> @weakify(self);<br> return [[[[[RACSignal<pre><code><span class="rule"><span class="attribute">defer</span>:<span class="value">^{
    @<span class="function">strongify</span>(self)</span></span>;
    <span class="tag">return</span> <span class="attr_selector">[RACSignal return:self]</span>;
}]
<span class="rule"><span class="attribute">concat</span>:<span class="value">[self rac_signalForControlEvents:UIControlEventAllEditingEvents]]
map:^(UITextField *x) {
    return x.text</span></span>;
}]
<span class="rule"><span class="attribute">takeUntil</span>:<span class="value">self.rac_willDeallocSignal]
setNameWithFormat:@<span class="string">"%@ -rac_textSignal"</span>, self.rac_description]</span></span>;
</code></pre>}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;&#20960;&#20010;&#20851;&#38190;&#35789;&#30340;&#35299;&#37322;:&#10;`defer` : &#23558;&#20195;&#30721;&#30340;&#21019;&#24314;&#25512;&#36831;&#21040;&#20449;&#21495;&#34987;&#35746;&#38405;&#10;`concat`: &#36830;&#25509;&#20449;&#21495;,&#31532;&#19968;&#20010;&#20449;&#21495;&#24517;&#39035;&#21457;&#36865;&#23436;&#25104;&#65292;&#31532;&#20108;&#20010;&#20449;&#21495;&#25165;&#20250;&#34987;&#28608;&#27963;&#10;`map` : &#26144;&#23556;,&#23558;&#20449;&#21495;&#20869;&#23481;&#36716;&#25442;&#10;`takeUtil` :  signalA takeUntil:signalB &#24403;signalB&#28608;&#27963;&#20043;&#21518;,&#20572;&#27490;signalA &#30340;&#35746;&#38405;&#10;&#10;&#20854;&#23454;&#20027;&#35201;&#30340;&#26159;, &#36825;&#20010; `signal` &#26159;&#30417;&#21548;&#30340;: `UIControlEventAllEditingEvents` . &#37027;&#20040;&#20063;&#23601;&#26159;&#35828;&#23545;`setter` &#26041;&#24335;&#19981;&#20250;&#35302;&#21457;&#20449;&#21495; &#10;&#10;`RACObserve` &#26159;&#19968;&#20010;&#24120;&#29992;&#30340;&#23439;,&#25105;&#20204;&#37117;&#30693;&#36947;&#26159;&#30417;&#21548;&#23646;&#24615;&#20540;&#25913;&#21464;&#30340;.</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h1 id="define_RACObserve(TARGET,_KEYPATH)_\">define RACObserve(TARGET, KEYPATH) \</h1><pre><code><span class="list">(<span class="collection">{ \
    _Pragma<span class="list">(<span class="string">"clang diagnostic push"</span>)</span> \
    _Pragma<span class="list">(<span class="string">"clang diagnostic ignored \"-Wreceiver-is-weak\""</span>)</span> \
    __weak id target_ = <span class="list">(<span class="keyword">TARGET</span>)</span><span class="comment">; \</span>
    <span class="collection">[target_ rac_valuesForKeyPath:@keypath<span class="list">(<span class="keyword">TARGET</span>, KEYPATH)</span> observer:self]</span><span class="comment">; \</span>
    _Pragma<span class="list">(<span class="string">"clang diagnostic pop"</span>)</span> \
}</span>)</span>
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;&#20027;&#35201;&#20195;&#30721;&#26159;:`&#9;[target_ rac_valuesForKeyPath:@keypath(TARGET, KEYPATH) observer:self]; `&#10;&#28982;&#21518;&#36825;&#20010;`rac_valuesForKeyPath `&#30340;&#23454;&#29616;&#22914;&#19979;:</span><br></pre></td></tr></table></figure>
<ul>
<li><p>(RACSignal <em>)rac_valuesForKeyPath:(NSString </em>)keyPath observer:(__weak NSObject *)observer {<br>  return [[[self</p>
<pre><code><span class="string">rac_valuesAndChangesForKeyPath:</span>keyPath <span class="string">options:</span>NSKeyValueObservingOptionInitial <span class="string">observer:</span>observer]
<span class="string">map:</span>^(RACTuple *value) {
    <span class="comment">// -map: because it doesn't require the block trampoline that -reduceEach: uses</span>
    <span class="keyword">return</span> value[<span class="number">0</span>];
}]
<span class="string">setNameWithFormat:</span>@<span class="string">"RACObserve(%@, %@)"</span>, self.rac_description, keyPath];
</code></pre><p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;&#20027;&#35201;&#20195;&#30721;:</span><br></pre></td></tr></table></figure>
<p>  rac_valuesAndChangesForKeyPath:keyPath options:NSKeyValueObservingOptionInitial observer:observer]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#20063;&#23601;&#26159;&#36825;&#20010;&#26159;&#36890;&#36807; `KVO` &#23454;&#29616;&#30340;. &#32780; `KVO` &#24471;&#23454;&#29616;&#26159;&#36890;&#36807;&#20020;&#26102;&#29983;&#25104;&#19968;&#20010;&#23376;&#31867;,&#24182;&#37325;&#20889;&#29238;&#31867;&#30340; `setter` &#26041;&#27861;.&#36825;&#20010;&#22312;&#23448;&#26041;&#25991;&#26723;&#20013;&#26377;&#35828;&#26126;:</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Key-Value Observing Implementation Details</p>
<p>Automatic key-value observing is implemented using a technique called isa-swizzling.<br>The isa pointer, as the name suggests, points to the object’s class which maintains a dispatch table. This dispatch table essentially contains pointers to the methods the class implements, among other data.<br>When an observer is registered for an attribute of an object the isa pointer of the observed object is modified, pointing to an intermediate class rather than at the true class. As a result the value of the isa pointer does not necessarily reflect the actual class of the instance.<br>You should never rely on the isa pointer to determine class membership. Instead, you should use the class method to determine the class of an object instance.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;### &#26368;&#32456;&#23454;&#29616;&#10;&#10;&#20102;&#35299;&#20102;&#20004;&#32773;&#30340;&#23454;&#29616;,&#23601;&#21487;&#20197;&#24456;&#23481;&#26131;&#23454;&#29616;&#20195;&#30721;:</span><br></pre></td></tr></table></figure>
<pre><code>RAC(<span class="keyword">self</span><span class="variable">.loginButton</span>,enabled) =[ [RACObserve(<span class="keyword">self</span><span class="variable">.textFiled</span>, text)  merge:<span class="keyword">self</span><span class="variable">.textFiled</span><span class="variable">.rac_textSignal</span> ] map:^<span class="keyword">id</span>(<span class="built_in">NSString</span> *value) {
     <span class="keyword">return</span> @(value<span class="variable">.length</span>&gt;<span class="number">3</span>);
}];
</code></pre><p>```</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/ReactiveCocoa/">ReactiveCocoa</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/ReactiveCocoa/">ReactiveCocoa</a>
  </div>

        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<!-- 多说评论框 start -->
  <div class="ds-thread" data-thread-key="2016/06/18/ReactiveCocoa/RACObserve-和-rac-textSignal-的搭配使用/" data-title="RACObserve 和 rac_textSignal 的搭配使用" data-url="http://yoursite.com/2016/06/18/ReactiveCocoa/RACObserve-和-rac-textSignal-的搭配使用/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"guiqingblog"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共JS代码 end -->

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/ClassyLiveLayout/">ClassyLiveLayout</a><small>1</small></li>
  
    <li><a href="/categories/Core-Aniamtion深入探讨/">Core Aniamtion深入探讨</a><small>15</small></li>
  
    <li><a href="/categories/Git/">Git</a><small>1</small></li>
  
    <li><a href="/categories/ReactiveCocoa/">ReactiveCocoa</a><small>3</small></li>
  
    <li><a href="/categories/Swift/">Swift</a><small>2</small></li>
  
    <li><a href="/categories/Swift进阶/">Swift进阶</a><small>4</small></li>
  
    <li><a href="/categories/iOS-Tips/">iOS Tips</a><small>14</small></li>
  
    <li><a href="/categories/主页维护记录/">主页维护记录</a><small>4</small></li>
  
    <li><a href="/categories/利用Runtime实现自依赖按钮/">利用Runtime实现自依赖按钮</a><small>1</small></li>
  
    <li><a href="/categories/开发环境相关/">开发环境相关</a><small>5</small></li>
  
    <li><a href="/categories/悟/">悟</a><small>1</small></li>
  
    <li><a href="/categories/知识技巧总结/">知识技巧总结</a><small>1</small></li>
  
    <li><a href="/categories/算法专题/">算法专题</a><small>1</small></li>
  
    <li><a href="/categories/辅助编程技能/">辅助编程技能</a><small>7</small></li>
  
    <li><a href="/categories/重构、模式、架构/">重构、模式、架构</a><small>10</small></li>
  
    <li><a href="/categories/高效OC编程/">高效OC编程</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/ClassyLiveLayout/">ClassyLiveLayout</a><small>1</small></li>
  
    <li><a href="/tags/Core-Aniamtion深入探讨/">Core Aniamtion深入探讨</a><small>15</small></li>
  
    <li><a href="/tags/Git-命令/">Git 命令</a><small>1</small></li>
  
    <li><a href="/tags/ReactiveCocoa/">ReactiveCocoa</a><small>3</small></li>
  
    <li><a href="/tags/Swift/">Swift</a><small>2</small></li>
  
    <li><a href="/tags/Swift-进阶/">Swift 进阶</a><small>1</small></li>
  
    <li><a href="/tags/Swift进阶/">Swift进阶</a><small>1</small></li>
  
    <li><a href="/tags/Swift进阶-variable-with-a-setter-must-also-have-a-getter/">Swift进阶 variable with a setter must also have a getter</a><small>1</small></li>
  
    <li><a href="/tags/iOS-Tips/">iOS Tips</a><small>3</small></li>
  
    <li><a href="/tags/主页维护记录/">主页维护记录</a><small>2</small></li>
  
    <li><a href="/tags/利用Runtime实现自依赖按钮/">利用Runtime实现自依赖按钮</a><small>1</small></li>
  
    <li><a href="/tags/小脚本大智慧/">小脚本大智慧</a><small>1</small></li>
  
    <li><a href="/tags/开发环境相关/">开发环境相关</a><small>3</small></li>
  
    <li><a href="/tags/悟/">悟</a><small>1</small></li>
  
    <li><a href="/tags/正则表达式/">正则表达式</a><small>2</small></li>
  
    <li><a href="/tags/测试小样/">测试小样</a><small>1</small></li>
  
    <li><a href="/tags/算法专题-字符串/">算法专题 字符串</a><small>1</small></li>
  
    <li><a href="/tags/设计模式/">设计模式</a><small>1</small></li>
  
    <li><a href="/tags/辅助编程技能/">辅助编程技能</a><small>2</small></li>
  
    <li><a href="/tags/重构、模式、架构/">重构、模式、架构</a><small>5</small></li>
  
    <li><a href="/tags/问题解决和思考/">问题解决和思考</a><small>5</small></li>
  
    <li><a href="/tags/高效OC编程/">高效OC编程</a><small>4</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 桂庆
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>