<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>通过重构实现模板方法模式（Template Method ) 模式篇 | Kenny 肉桂的主页</title>
  <meta name="author" content="桂庆">
  
  <meta name="description" content="Kenny 肉桂的主页 记录自己的进步">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="通过重构实现模板方法模式（Template Method ) 模式篇"/>
  <meta property="og:site_name" content="Kenny 肉桂的主页"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Kenny 肉桂的主页" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Kenny 肉桂的主页</a></h1>
  <h2><a href="/">记录自己的进步</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">主页</a></li>
    
      <li><a href="/about">关于我</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2015-08-06T03:26:58.000Z"><a href="/2015/08/06/重构、模式、架构/通过重构实现模板方法模式（Template-Method-模式篇/">2015-08-06</a></time>
      
      
  
    <h1 class="title">通过重构实现模板方法模式（Template Method ) 模式篇</h1>
  

    </header>
    <div class="entry">
      
        <h2 id="书接上文">书接上文</h2><p>上次使用了一些简单地重构方法,得到的最终代码如下:<br><a id="more"></a><br>.h 未做改动,文件省略<br>.m 文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#import &#34;GUIResetPasswordController.h&#34;&#10;#import &#34;GUIChangePasswordController.h&#34;&#10;#import &#60;SMS_SDK/SMS_SDK.h&#62;&#10;#import &#34;GUIHeader.h&#34;&#10;&#10;&#10;&#10;@interface GUIResetPasswordController ()&#10;&#10;@property (nonatomic, weak) UITextField *phonenumberTextfield;&#10;@property (nonatomic, weak) UITextField *verifyCodeTextfield;&#10;@property (nonatomic, weak) UIButton    *getVerifyCodeButton;&#10;@property (nonatomic, weak) UIButton    *submitButton;&#10;&#10;@end&#10;&#10;static NSInteger secondsCoutDown;&#10;static NSTimer   *countDownTimer;&#10;&#10;static CGFloat const kLeftViewHeight = 40;&#10;static CGFloat const kLeftViewWidth  = 40;&#10;&#10;&#10;@implementation GUIResetPasswordController&#10;&#10;&#10;&#10;&#10;&#10;#pragma mark -life cycle&#10;- (void)viewDidLoad &#123;&#10;    [super viewDidLoad];&#10;&#10;    self.view.backgroundColor = kcMainGrayBackgroud;&#10;&#10;    [self setupPhoneNumberTextField];&#10;&#10;    [self setupVerifiedCodeTextField];&#10;&#10;    [self setupGetVerifiyCodeButton];&#10;&#10;    [self setupSubmitButton];&#10;&#10;&#10;&#125;&#10;&#10;- (void)viewWillLayoutSubviews &#123;&#10;    [super viewWillLayoutSubviews];&#10;&#10;    WSE(ws);&#10;&#10;    static const CGFloat kTextFieldHeight = 50;&#10;    [self.phonenumberTextfield mas_makeConstraints:^(MASConstraintMaker *make) &#123;&#10;         make.top.mas_equalTo(ws.view);&#10;         make.leading.mas_equalTo(ws.view);&#10;         make.trailing.mas_equalTo(ws.view);&#10;         make.height.mas_equalTo(kTextFieldHeight);&#10;     &#125;];&#10;&#10;    [self.verifyCodeTextfield mas_makeConstraints:^(MASConstraintMaker *make) &#123;&#10;         make.top.mas_equalTo(ws.phonenumberTextfield.mas_bottom).with.offset(1);&#10;         make.leading.mas_equalTo(ws.view);&#10;         make.trailing.mas_equalTo(ws.view).with.offset(-GUIScreenWidth/3);&#10;         make.height.mas_equalTo(kTextFieldHeight);&#10;     &#125;];&#10;&#10;    [self.getVerifyCodeButton mas_makeConstraints:^(MASConstraintMaker *make) &#123;&#10;         make.size.mas_equalTo(CGSizeMake(GUIScreenWidth/3, kTextFieldHeight));&#10;         make.leading.mas_equalTo(ws.verifyCodeTextfield.mas_trailing);&#10;         make.bottom.mas_equalTo(ws.verifyCodeTextfield);&#10;     &#125;];&#10;&#10;    [self.submitButton mas_makeConstraints:^(MASConstraintMaker *make) &#123;&#10;         make.size.mas_equalTo(CGSizeMake(GUIScreenWidth/3, 30));&#10;         make.leading.mas_equalTo((GUIScreenWidth-(GUIScreenWidth/3))/2);&#10;         make.top.mas_equalTo(ws.verifyCodeTextfield.mas_bottom).with.offset(60);&#10;     &#125;];&#10;&#10;&#10;&#125;&#10;&#10;#pragma mark -  delegate&#10;&#10;#pragma mark -event response&#10;- (void)getTheCodeAgain &#123;&#10;&#10;    secondsCoutDown                  = 60;&#10;    self.getVerifyCodeButton.enabled = NO;&#10;    countDownTimer                   = [NSTimer scheduledTimerWithTimeInterval:1 target:self selector:@selector(timeDown) userInfo:nil repeats:YES];&#10;&#10;&#125;&#10;&#10;- (void)nextStep:(UIButton *)button &#123;&#10;&#10;    [SMS_SDK commitVerifyCode:self.verifyCodeTextfield.text result:^(enum SMS_ResponseState state) &#123;&#10;         if (state == SMS_ResponseStateSuccess) &#123;&#10;             [MBProgressHUD showMessage:@&#34;&#27491;&#22312;&#39564;&#35777; ... &#34;];&#10;             [self.navigationController pushViewController:[[GUIChangePasswordController alloc]init] animated:YES];&#10;             [MBProgressHUD hideHUD];&#10;         &#125; else &#123;&#10;             [MBProgressHUD showError:@&#34;&#39564;&#35777;&#22833;&#36133;&#34;];&#10;         &#125;&#10;     &#125;];&#10;#warning temp code ,remember to delete&#10;    [self.navigationController pushViewController:[[GUIChangePasswordController alloc]init] animated:YES];&#10;&#10;&#125;&#10;&#10;#pragma  mark - share sdk sms&#10;- (void)getVerifyCode:(UIButton *)button &#123;&#10;&#10;    if (self.phonenumberTextfield.text == nil) &#123;&#10;        [MBProgressHUD showError:@&#34;&#35831;&#20808;&#22635;&#20889;&#25163;&#26426;&#21495;&#30721;&#34;];&#10;        return;&#10;    &#125;&#10;&#10;&#10;    NSString *phoneNumber = self.phonenumberTextfield.text;&#10;&#10;#warning temp code ,remember to delete&#10;    NSArray  *paths        = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);&#10;    NSString *documentPath = [paths lastObject];&#10;    NSString *filePath     = [documentPath stringByAppendingPathComponent:@&#34;resetPhoneNumber.plist&#34;];&#10;    [phoneNumber writeToFile:filePath atomically:YES encoding:NSUTF8StringEncoding error:nil];&#10;&#10;    [SMS_SDK getVerificationCodeBySMSWithPhone:phoneNumber zone:@&#34;86&#34; result:^(SMS_SDKError *error) &#123;&#10;         //save phone number to file&#10;         NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);&#10;         NSString *documentPath = [paths lastObject];&#10;         NSString *filePath = [documentPath stringByAppendingPathComponent:@&#34;resetPhoneNumber.plist&#34;];&#10;         [phoneNumber writeToFile:filePath atomically:YES encoding:NSUTF8StringEncoding error:nil];&#10;     &#125;];&#10;&#10;    [self getTheCodeAgain];&#10;&#125;&#10;&#10;#pragma mark -private methods&#10;&#10;- (void)timeDown &#123;&#10;    secondsCoutDown--;&#10;    if (secondsCoutDown == 0) &#123;&#10;        [countDownTimer invalidate];&#10;        self.getVerifyCodeButton.enabled = YES;&#10;    &#125;&#10;    [self.getVerifyCodeButton setTitle:[NSString stringWithFormat:@&#34;&#35831;&#31561;&#24453; %ld &#31186;&#34;, (long)secondsCoutDown] forState:UIControlStateDisabled];&#10;&#125;&#10;&#10;- (UIImageView *)textLeftViewWithImage:(UIImage *)leftImage &#123;&#10;    UIImageView *containerView = [[UIImageView alloc] init];&#10;    UIImageView *iconView      = [[UIImageView alloc]init];&#10;    iconView.image = leftImage;&#10;    [containerView addSubview:iconView];&#10;&#10;    UIImageView *seperatorView = [[UIImageView alloc]init];&#10;    seperatorView.backgroundColor = [UIColor redColor];&#10;    [containerView addSubview:seperatorView];&#10;    //set frame&#10;    containerView.bounds = CGRectMake(0, 0, kLeftViewWidth+20, kLeftViewWidth);&#10;&#10;    CGFloat iconViewWH = 20;&#10;    CGFloat iconViewX  = (kLeftViewWidth - iconViewWH)/2;&#10;    CGFloat iconViewY  = (kLeftViewHeight - iconViewWH)/2;&#10;&#10;    iconView.frame = CGRectMake(iconViewX, iconViewY, iconViewWH, iconViewWH);&#10;&#10;    CGFloat seperatorW = 1;&#10;    CGFloat seperatorH = 20;&#10;    CGFloat seperatorX = kLeftViewWidth-seperatorW;&#10;    CGFloat seperatorY = (kLeftViewHeight-seperatorH)/2;&#10;&#10;    seperatorView.frame = CGRectMake(seperatorX, seperatorY, seperatorW, seperatorH);&#10;&#10;    return containerView;&#10;&#125;&#10;&#10;- (void)setupPhoneNumberTextField &#123;&#10;&#10;    UITextField *phonenumberTextfield = [[UITextField alloc]init];&#10;    phonenumberTextfield.leftView        = [self textLeftViewWithImage:[UIImage imageNamed:@&#34;zhuce_dianhua&#34;]];&#10;    phonenumberTextfield.leftViewMode    = UITextFieldViewModeAlways;&#10;    phonenumberTextfield.placeholder     = @&#34;&#24744;&#30340;&#25163;&#26426;&#21495;&#34;;&#10;    phonenumberTextfield.backgroundColor = [UIColor whiteColor];&#10;    phonenumberTextfield.clearButtonMode = UITextFieldViewModeWhileEditing;&#10;    [self.view addSubview:phonenumberTextfield];&#10;    self.phonenumberTextfield = phonenumberTextfield;&#10;&#10;&#125;&#10;&#10;- (void)setupVerifiedCodeTextField &#123;&#10;&#10;    UITextField *verifyCodeTextfield = [[UITextField alloc]init];&#10;    verifyCodeTextfield.leftView        = [self textLeftViewWithImage:[UIImage imageNamed:@&#34;zhuce_yanzhengma&#34;]];&#10;    verifyCodeTextfield.leftViewMode    = UITextFieldViewModeAlways;&#10;    verifyCodeTextfield.placeholder     = @&#34;&#36755;&#20837;&#39564;&#35777;&#30721;&#34;;&#10;    verifyCodeTextfield.backgroundColor = [UIColor whiteColor];&#10;    [self.view addSubview:verifyCodeTextfield];&#10;    self.verifyCodeTextfield = verifyCodeTextfield;&#10;&#10;&#10;&#125;&#10;&#10;- (void)setupGetVerifiyCodeButton &#123;&#10;&#10;    UIButton *getVerifyCodeButton = [[UIButton alloc]init];&#10;    [getVerifyCodeButton setTitle:@&#34;&#33719;&#21462;&#39564;&#35777;&#30721;&#34; forState:UIControlStateNormal];&#10;    [getVerifyCodeButton setBackgroundColor:kcMainRed];&#10;    [getVerifyCodeButton setTitleColor:kcMainGrayBackgroud forState:UIControlStateNormal];&#10;    [getVerifyCodeButton addTarget:self action:@selector(getVerifyCode:) forControlEvents:UIControlEventTouchUpInside];&#10;    [self.view addSubview:getVerifyCodeButton];&#10;    self.getVerifyCodeButton = getVerifyCodeButton;&#10;&#10;&#125;&#10;&#10;- (void)setupSubmitButton &#123;&#10;&#10;    UIButton *submitButton = [[UIButton alloc] init];&#10;    [submitButton setTitle:@&#34;&#19979;&#19968;&#27493;&#34; forState:UIControlStateNormal];&#10;    [submitButton setBackgroundColor:[UIColor whiteColor]];&#10;    submitButton.layer.cornerRadius = 3;&#10;    [submitButton setTitleColor:kcMainRed forState:UIControlStateNormal];&#10;    [submitButton addTarget:self action:@selector(nextStep:) forControlEvents:UIControlEventTouchUpInside];&#10;    [self.view addSubview:submitButton];&#10;    self.submitButton = submitButton;&#10;&#10;&#125;&#10;&#10;#pragma mark -getters and setters&#10;&#10;&#10;&#10;@end</span><br></pre></td></tr></table></figure>
<h2 id="模板方法">模板方法</h2><p><code>模板方法</code>设计模式是最常用来避免<code>直接复制代码</code>的设计模式.</p>
<h3 id="1-_隔离变化">1. 隔离变化</h3><p> 所谓的隔离变化,概括起来说就是: </p>
<ul>
<li>对比两份或者多份代码,找出不同点</li>
<li>抽取出方法 (要求子类必须重写)</li>
<li>将公共代码作为模板类.</li>
<li>子类实现差异方法</li>
</ul>
<h3 id="2-创建模板类">2.创建模板类</h3><p>新建模板控制器 <code>GUIVaiidationTemplateController</code> </p>
<p><img src="http://7xkv7m.com1.z0.glb.clouddn.com/template-refactoringQQ20150806-8@2x.png" alt=""></p>
<p>在编写模板类的时候,我的最佳实践步骤是: </p>
<ul>
<li>版本控制保存当前状态</li>
<li>拷贝重构好的代码到模板类</li>
<li>原控制器继承模板类</li>
<li>将差异抽取,并在子类中分别实现</li>
</ul>
<p>拷贝完毕的代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#10;#import &#34;GUIVaiidationTemplateController.h&#34;&#10;#import &#60;SMS_SDK/SMS_SDK.h&#62;&#10;#import &#34;GUIHeader.h&#34;&#10;&#10;&#10;static NSInteger secondsCoutDown;&#10;static NSTimer   *countDownTimer;&#10;&#10;static CGFloat const kLeftViewHeight = 40;&#10;static CGFloat const kLeftViewWidth  = 40;&#10;&#10;&#10;@interface GUIVaiidationTemplateController ()&#10;&#10;@property (nonatomic, weak) UITextField *phonenumberTextfield;&#10;@property (nonatomic, weak) UITextField *verifyCodeTextfield;&#10;@property (nonatomic, weak) UIButton    *getVerifyCodeButton;&#10;@property (nonatomic, weak) UIButton    *submitButton;&#10;&#10;@end&#10;&#10;&#10;@implementation GUIVaiidationTemplateController&#10;&#10;&#10;#pragma mark -life cycle&#10;- (void)viewDidLoad &#123;&#10;    [super viewDidLoad];&#10;    &#10;    self.view.backgroundColor = kcMainGrayBackgroud;&#10;    &#10;    [self setupPhoneNumberTextField];&#10;    &#10;    [self setupVerifiedCodeTextField];&#10;    &#10;    [self setupGetVerifiyCodeButton];&#10;    &#10;    [self setupSubmitButton];&#10;    &#10;    &#10;&#125;&#10;&#10;- (void)viewWillLayoutSubviews &#123;&#10;    [super viewWillLayoutSubviews];&#10;    &#10;    WSE(ws);&#10;    &#10;    static const CGFloat kTextFieldHeight = 50;&#10;    [self.phonenumberTextfield mas_makeConstraints:^(MASConstraintMaker *make) &#123;&#10;        make.top.mas_equalTo(ws.view);&#10;        make.leading.mas_equalTo(ws.view);&#10;        make.trailing.mas_equalTo(ws.view);&#10;        make.height.mas_equalTo(kTextFieldHeight);&#10;    &#125;];&#10;    &#10;    [self.verifyCodeTextfield mas_makeConstraints:^(MASConstraintMaker *make) &#123;&#10;        make.top.mas_equalTo(ws.phonenumberTextfield.mas_bottom).with.offset(1);&#10;        make.leading.mas_equalTo(ws.view);&#10;        make.trailing.mas_equalTo(ws.view).with.offset(-GUIScreenWidth/3);&#10;        make.height.mas_equalTo(kTextFieldHeight);&#10;    &#125;];&#10;    &#10;    [self.getVerifyCodeButton mas_makeConstraints:^(MASConstraintMaker *make) &#123;&#10;        make.size.mas_equalTo(CGSizeMake(GUIScreenWidth/3, kTextFieldHeight));&#10;        make.leading.mas_equalTo(ws.verifyCodeTextfield.mas_trailing);&#10;        make.bottom.mas_equalTo(ws.verifyCodeTextfield);&#10;    &#125;];&#10;    &#10;    [self.submitButton mas_makeConstraints:^(MASConstraintMaker *make) &#123;&#10;        make.size.mas_equalTo(CGSizeMake(GUIScreenWidth/3, 30));&#10;        make.leading.mas_equalTo((GUIScreenWidth-(GUIScreenWidth/3))/2);&#10;        make.top.mas_equalTo(ws.verifyCodeTextfield.mas_bottom).with.offset(60);&#10;    &#125;];&#10;    &#10;    &#10;&#125;&#10;&#10;#pragma mark -  delegate&#10;&#10;#pragma mark -event response&#10;- (void)getTheCodeAgain &#123;&#10;    &#10;    secondsCoutDown                  = 60;&#10;    self.getVerifyCodeButton.enabled = NO;&#10;    countDownTimer                   = [NSTimer scheduledTimerWithTimeInterval:1 target:self selector:@selector(timeDown) userInfo:nil repeats:YES];&#10;    &#10;&#125;&#10;&#10;- (void)nextStep:(UIButton *)button &#123;&#10;    &#10;    [SMS_SDK commitVerifyCode:self.verifyCodeTextfield.text result:^(enum SMS_ResponseState state) &#123;&#10;        if (state == SMS_ResponseStateSuccess) &#123;&#10;            [MBProgressHUD showMessage:@&#34;&#27491;&#22312;&#39564;&#35777; ... &#34;];&#10;            [self.navigationController pushViewController:[[GUIChangePasswordController alloc]init] animated:YES];&#10;            [MBProgressHUD hideHUD];&#10;        &#125; else &#123;&#10;            [MBProgressHUD showError:@&#34;&#39564;&#35777;&#22833;&#36133;&#34;];&#10;        &#125;&#10;    &#125;];&#10;#warning temp code ,remember to delete&#10;    [self.navigationController pushViewController:[[GUIChangePasswordController alloc]init] animated:YES];&#10;    &#10;&#125;&#10;&#10;#pragma  mark - share sdk sms&#10;- (void)getVerifyCode:(UIButton *)button &#123;&#10;    &#10;    if (self.phonenumberTextfield.text == nil) &#123;&#10;        [MBProgressHUD showError:@&#34;&#35831;&#20808;&#22635;&#20889;&#25163;&#26426;&#21495;&#30721;&#34;];&#10;        return;&#10;    &#125;&#10;    &#10;    &#10;    NSString *phoneNumber = self.phonenumberTextfield.text;&#10;    &#10;#warning temp code ,remember to delete&#10;    NSArray  *paths        = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);&#10;    NSString *documentPath = [paths lastObject];&#10;    NSString *filePath     = [documentPath stringByAppendingPathComponent:@&#34;resetPhoneNumber.plist&#34;];&#10;    [phoneNumber writeToFile:filePath atomically:YES encoding:NSUTF8StringEncoding error:nil];&#10;    &#10;    [SMS_SDK getVerificationCodeBySMSWithPhone:phoneNumber zone:@&#34;86&#34; result:^(SMS_SDKError *error) &#123;&#10;        //save phone number to file&#10;        NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);&#10;        NSString *documentPath = [paths lastObject];&#10;        NSString *filePath = [documentPath stringByAppendingPathComponent:@&#34;resetPhoneNumber.plist&#34;];&#10;        [phoneNumber writeToFile:filePath atomically:YES encoding:NSUTF8StringEncoding error:nil];&#10;    &#125;];&#10;    &#10;    [self getTheCodeAgain];&#10;&#125;&#10;&#10;#pragma mark -private methods&#10;&#10;- (void)timeDown &#123;&#10;    secondsCoutDown--;&#10;    if (secondsCoutDown == 0) &#123;&#10;        [countDownTimer invalidate];&#10;        self.getVerifyCodeButton.enabled = YES;&#10;    &#125;&#10;    [self.getVerifyCodeButton setTitle:[NSString stringWithFormat:@&#34;&#35831;&#31561;&#24453; %ld &#31186;&#34;, (long)secondsCoutDown] forState:UIControlStateDisabled];&#10;&#125;&#10;&#10;- (UIImageView *)textLeftViewWithImage:(UIImage *)leftImage &#123;&#10;    UIImageView *containerView = [[UIImageView alloc] init];&#10;    UIImageView *iconView      = [[UIImageView alloc]init];&#10;    iconView.image = leftImage;&#10;    [containerView addSubview:iconView];&#10;    &#10;    UIImageView *seperatorView = [[UIImageView alloc]init];&#10;    seperatorView.backgroundColor = [UIColor redColor];&#10;    [containerView addSubview:seperatorView];&#10;    //set frame&#10;    containerView.bounds = CGRectMake(0, 0, kLeftViewWidth+20, kLeftViewWidth);&#10;    &#10;    CGFloat iconViewWH = 20;&#10;    CGFloat iconViewX  = (kLeftViewWidth - iconViewWH)/2;&#10;    CGFloat iconViewY  = (kLeftViewHeight - iconViewWH)/2;&#10;    &#10;    iconView.frame = CGRectMake(iconViewX, iconViewY, iconViewWH, iconViewWH);&#10;    &#10;    CGFloat seperatorW = 1;&#10;    CGFloat seperatorH = 20;&#10;    CGFloat seperatorX = kLeftViewWidth-seperatorW;&#10;    CGFloat seperatorY = (kLeftViewHeight-seperatorH)/2;&#10;    &#10;    seperatorView.frame = CGRectMake(seperatorX, seperatorY, seperatorW, seperatorH);&#10;    &#10;    return containerView;&#10;&#125;&#10;&#10;- (void)setupPhoneNumberTextField &#123;&#10;    &#10;    UITextField *phonenumberTextfield = [[UITextField alloc]init];&#10;    phonenumberTextfield.leftView        = [self textLeftViewWithImage:[UIImage imageNamed:@&#34;zhuce_dianhua&#34;]];&#10;    phonenumberTextfield.leftViewMode    = UITextFieldViewModeAlways;&#10;    phonenumberTextfield.placeholder     = @&#34;&#24744;&#30340;&#25163;&#26426;&#21495;&#34;;&#10;    phonenumberTextfield.backgroundColor = [UIColor whiteColor];&#10;    phonenumberTextfield.clearButtonMode = UITextFieldViewModeWhileEditing;&#10;    [self.view addSubview:phonenumberTextfield];&#10;    self.phonenumberTextfield = phonenumberTextfield;&#10;    &#10;&#125;&#10;&#10;- (void)setupVerifiedCodeTextField &#123;&#10;    &#10;    UITextField *verifyCodeTextfield = [[UITextField alloc]init];&#10;    verifyCodeTextfield.leftView        = [self textLeftViewWithImage:[UIImage imageNamed:@&#34;zhuce_yanzhengma&#34;]];&#10;    verifyCodeTextfield.leftViewMode    = UITextFieldViewModeAlways;&#10;    verifyCodeTextfield.placeholder     = @&#34;&#36755;&#20837;&#39564;&#35777;&#30721;&#34;;&#10;    verifyCodeTextfield.backgroundColor = [UIColor whiteColor];&#10;    [self.view addSubview:verifyCodeTextfield];&#10;    self.verifyCodeTextfield = verifyCodeTextfield;&#10;    &#10;    &#10;&#125;&#10;&#10;- (void)setupGetVerifiyCodeButton &#123;&#10;    &#10;    UIButton *getVerifyCodeButton = [[UIButton alloc]init];&#10;    [getVerifyCodeButton setTitle:@&#34;&#33719;&#21462;&#39564;&#35777;&#30721;&#34; forState:UIControlStateNormal];&#10;    [getVerifyCodeButton setBackgroundColor:kcMainRed];&#10;    [getVerifyCodeButton setTitleColor:kcMainGrayBackgroud forState:UIControlStateNormal];&#10;    [getVerifyCodeButton addTarget:self action:@selector(getVerifyCode:) forControlEvents:UIControlEventTouchUpInside];&#10;    [self.view addSubview:getVerifyCodeButton];&#10;    self.getVerifyCodeButton = getVerifyCodeButton;&#10;    &#10;&#125;&#10;&#10;- (void)setupSubmitButton &#123;&#10;    &#10;    UIButton *submitButton = [[UIButton alloc] init];&#10;    [submitButton setTitle:@&#34;&#19979;&#19968;&#27493;&#34; forState:UIControlStateNormal];&#10;    [submitButton setBackgroundColor:[UIColor whiteColor]];&#10;    submitButton.layer.cornerRadius = 3;&#10;    [submitButton setTitleColor:kcMainRed forState:UIControlStateNormal];&#10;    [submitButton addTarget:self action:@selector(nextStep:) forControlEvents:UIControlEventTouchUpInside];&#10;    [self.view addSubview:submitButton];&#10;    self.submitButton = submitButton;&#10;    &#10;&#125;&#10;&#10;#pragma mark -getters and setters&#10;&#10;&#10;&#10;@end</span><br></pre></td></tr></table></figure>
<p>好的,现在开始对比两个子类. 两个子类的代码和上面的代码类似,就不上代码了. </p>
<p>以上面的代码为例,首先提取变化.</p>
<p>我粘贴完毕之后,发现在跳转控制器的地方,需要有这个控制器 <code>GUIChangePasswordController</code> ,而另一个注册的子类没有,所以这就是一个变化,应该将这个变化放到一个方法中.</p>
<p>在子类和模板类的方法有所不同, 模板类做的只是把方法提取出来,同时要求子类必须实现,自己不需要写具体的实现.</p>
<p>模板类中原代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[SMS_SDK commitVerifyCode:self.verifyCodeTextfield.text result:^(enum SMS_ResponseState state) &#123;&#10;       if (state == SMS_ResponseStateSuccess) &#123;&#10;           [MBProgressHUD showMessage:@&#34;&#27491;&#22312;&#39564;&#35777; ... &#34;];&#10;           [self.navigationController pushViewController:[[GUIChangePasswordController alloc]init] animated:YES];&#10;           [MBProgressHUD hideHUD];&#10;       &#125; else &#123;&#10;           [MBProgressHUD showError:@&#34;&#39564;&#35777;&#22833;&#36133;&#34;];&#10;       &#125;&#10;   &#125;];</span><br></pre></td></tr></table></figure>
<p>隔离变化后代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[SMS_SDK commitVerifyCode:self.verifyCodeTextfield.text result:^(enum SMS_ResponseState state) &#123;&#10;    if (state == SMS_ResponseStateSuccess) &#123;&#10;        [MBProgressHUD showMessage:@&#34;&#27491;&#22312;&#39564;&#35777; ... &#34;];&#10;        [self.navigationController pushViewController:[self pushTargetController] animated:YES];&#10;        [MBProgressHUD hideHUD];&#10;    &#125; else &#123;&#10;        [MBProgressHUD showError:@&#34;&#39564;&#35777;&#22833;&#36133;&#34;];&#10;    &#125;&#10;&#125;];</span><br></pre></td></tr></table></figure>
<p>重头戏来了 ! OC中没有任何关键字能要求子类必须重写父类的方法.那么很多的设计模式是不是对OC就不适用了呢 ? 其实还是有方法的.</p>
<p>在OC 2.0之后 , 大家都用 @throw了,更符合规范,但是1.0的 NSAssert 更加简洁,谁优谁劣,自己选择.</p>
<p>对应的要求子类必须实现的代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-(id)pushTargetController&#123;&#10;    //&#19981;&#20889;&#23454;&#29616;,&#23376;&#31867;&#24517;&#39035;&#37325;&#20889;&#27492;&#26041;&#27861;&#10;    @throw [NSException exceptionWithName:NSInternalInconsistencyException reason:[NSString stringWithFormat:@&#34;&#26041;&#27861;: %@ &#24517;&#39035;&#34987;&#23376;&#31867;&#23454;&#29616;&#34;,NSStringFromSelector(_cmd)] userInfo:nil];&#10; &#10;&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到,写了异常代码之后,返回值也不是必须的了,爽 !</p>
<p>到两个子类中实现跳转代码,为了方便,我称呼为 子类A 和 子类B</p>
<p>子类A<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-(id)pushTargetController&#123;&#10;   &#10;    return [[GUIChangePasswordController alloc]init];&#10;    &#10;&#125;</span><br></pre></td></tr></table></figure></p>
<p>子类B</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-(id)pushTargetController&#123;&#10;    &#10;    return [[GUISignupPasswordController alloc]init];&#10;    &#10;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="最后一步">最后一步</h2><p>接下来的工作就比较简单暴力了. 把两个子类中完全相同的代码删掉.<br>将差异的部分提取到父类,抽取方法. 重复进行.</p>
<h2 id="收尾">收尾</h2><p>运行,测试.</p>
<p>子类A完整代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#import &#34;GUIResetPasswordController.h&#34;&#10;#import &#34;GUIChangePasswordController.h&#34;&#10;&#10;&#10;@implementation GUIResetPasswordController&#10;&#10;#pragma mark -life cycle&#10;- (void)viewDidLoad &#123;&#10;    [super viewDidLoad];&#10;    self.title = @&#34;&#37325;&#32622;&#23494;&#30721;&#34;;&#10;&#125;&#10;&#10;#pragma mark -  delegate&#10;&#10;#pragma mark -event response&#10;&#10;#pragma mark -private methods&#10;&#10;-(id)pushTargetController&#123;&#10;   &#10;    return [[GUIChangePasswordController alloc]init];&#10;    &#10;&#125;&#10;#pragma mark -getters and setters&#10;&#10;@end</span><br></pre></td></tr></table></figure>
<p>子类B 代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@implementation GUISignupPasswordController&#10;&#10;-(void)viewDidLoad&#10;&#123;&#10;    [super viewDidLoad];&#10;    self.title = @&#34;&#29992;&#25143;&#27880;&#20876;&#34;;&#10;    &#10;&#125;&#10;&#10;&#10;#pragma mark -life cycle&#10;&#10;#pragma mark -  delegate&#10;&#10;#pragma mark -event response&#10;&#10;#pragma mark -private methods&#10;-(id)pushTargetController&#123;&#10;    &#10;    return [[GUISignupPasswordController alloc]init];&#10;    &#10;&#125;&#10;&#10;#pragma mark -getters and setters&#10;@end</span><br></pre></td></tr></table></figure>
<p>清爽吧 ?</p>
<h2 id="结语">结语</h2><h3 id="注意点">注意点</h3><ul>
<li>要养成随手编译的好习惯,尤其是在重构代码的过程中,随时发现问题.</li>
<li>善用git svn等版本控制工具,它们是你的后悔药.</li>
</ul>
<h3 id="不要再拷贝代码了">不要再拷贝代码了</h3><p>就如刚才的例子,如果有新需求,需要更改样式或者其他内容,那我需要分别修改两个类.这还只是两个类,如果是10个,20个呢 ? 程序员加班多得原因之一,就是为自己的不规范负责.</p>
<p>使用了模板方法,其实只要维护一份代码即可,以后增加新的类 ,只需要继承模板 ,维护起来非常方便.</p>

      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/重构、模式、架构/">重构、模式、架构</a>
  </div>

        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>

<!-- 多说评论框 start -->
  <div class="ds-thread" data-thread-key="2015/08/06/重构、模式、架构/通过重构实现模板方法模式（Template-Method-模式篇/" data-title="通过重构实现模板方法模式（Template Method ) 模式篇" data-url="http://yoursite.com/2015/08/06/重构、模式、架构/通过重构实现模板方法模式（Template-Method-模式篇/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"guiqingblog"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共JS代码 end -->

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3>
  <ul class="entry">
  
    <li><a href="/categories/ClassyLiveLayout/">ClassyLiveLayout</a><small>1</small></li>
  
    <li><a href="/categories/Core-Aniamtion深入探讨/">Core Aniamtion深入探讨</a><small>15</small></li>
  
    <li><a href="/categories/Git/">Git</a><small>1</small></li>
  
    <li><a href="/categories/ReactiveCocoa/">ReactiveCocoa</a><small>2</small></li>
  
    <li><a href="/categories/Swift/">Swift</a><small>1</small></li>
  
    <li><a href="/categories/Swift进阶/">Swift进阶</a><small>4</small></li>
  
    <li><a href="/categories/iOS-Tips/">iOS Tips</a><small>14</small></li>
  
    <li><a href="/categories/主页维护记录/">主页维护记录</a><small>4</small></li>
  
    <li><a href="/categories/利用Runtime实现自依赖按钮/">利用Runtime实现自依赖按钮</a><small>1</small></li>
  
    <li><a href="/categories/开发环境相关/">开发环境相关</a><small>5</small></li>
  
    <li><a href="/categories/悟/">悟</a><small>1</small></li>
  
    <li><a href="/categories/知识技巧总结/">知识技巧总结</a><small>1</small></li>
  
    <li><a href="/categories/算法专题/">算法专题</a><small>1</small></li>
  
    <li><a href="/categories/辅助编程技能/">辅助编程技能</a><small>7</small></li>
  
    <li><a href="/categories/重构、模式、架构/">重构、模式、架构</a><small>10</small></li>
  
    <li><a href="/categories/高效OC编程/">高效OC编程</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/ClassyLiveLayout/">ClassyLiveLayout</a><small>1</small></li>
  
    <li><a href="/tags/Core-Aniamtion深入探讨/">Core Aniamtion深入探讨</a><small>15</small></li>
  
    <li><a href="/tags/Git-命令/">Git 命令</a><small>1</small></li>
  
    <li><a href="/tags/ReactiveCocoa/">ReactiveCocoa</a><small>2</small></li>
  
    <li><a href="/tags/Swift/">Swift</a><small>1</small></li>
  
    <li><a href="/tags/Swift-进阶/">Swift 进阶</a><small>1</small></li>
  
    <li><a href="/tags/Swift进阶/">Swift进阶</a><small>1</small></li>
  
    <li><a href="/tags/Swift进阶-variable-with-a-setter-must-also-have-a-getter/">Swift进阶 variable with a setter must also have a getter</a><small>1</small></li>
  
    <li><a href="/tags/iOS-Tips/">iOS Tips</a><small>3</small></li>
  
    <li><a href="/tags/主页维护记录/">主页维护记录</a><small>2</small></li>
  
    <li><a href="/tags/利用Runtime实现自依赖按钮/">利用Runtime实现自依赖按钮</a><small>1</small></li>
  
    <li><a href="/tags/小脚本大智慧/">小脚本大智慧</a><small>1</small></li>
  
    <li><a href="/tags/开发环境相关/">开发环境相关</a><small>3</small></li>
  
    <li><a href="/tags/悟/">悟</a><small>1</small></li>
  
    <li><a href="/tags/正则表达式/">正则表达式</a><small>2</small></li>
  
    <li><a href="/tags/测试小样/">测试小样</a><small>1</small></li>
  
    <li><a href="/tags/算法专题-字符串/">算法专题 字符串</a><small>1</small></li>
  
    <li><a href="/tags/设计模式/">设计模式</a><small>1</small></li>
  
    <li><a href="/tags/辅助编程技能/">辅助编程技能</a><small>2</small></li>
  
    <li><a href="/tags/重构、模式、架构/">重构、模式、架构</a><small>5</small></li>
  
    <li><a href="/tags/问题解决和思考/">问题解决和思考</a><small>5</small></li>
  
    <li><a href="/tags/高效OC编程/">高效OC编程</a><small>4</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2016 桂庆
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>