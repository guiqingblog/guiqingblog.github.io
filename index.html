<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Kenny, 肉桂" />





  <link rel="alternate" href="/atom.xml" title="Kenny 肉桂的主页" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="Kenny 肉桂的主页 记录自己的进步">
<meta property="og:type" content="website">
<meta property="og:title" content="Kenny 肉桂的主页">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Kenny 肉桂的主页">
<meta property="og:description" content="Kenny 肉桂的主页 记录自己的进步">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kenny 肉桂的主页">
<meta name="twitter:description" content="Kenny 肉桂的主页 记录自己的进步">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 11483783,
      author: 'Katsura_Ke'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> Kenny 肉桂的主页 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
  
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Kenny 肉桂的主页</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">记录自己的进步</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/17/ReactiveCocoa/ReactiveCocoa的bind方法/" itemprop="url">
                  ReactiveCocoa的bind方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-06-17T22:03:59+08:00" content="2017-06-17">
              2017-06-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ReactiveCocoa/" itemprop="url" rel="index">
                    <span itemprop="name">ReactiveCocoa</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/06/17/ReactiveCocoa/ReactiveCocoa的bind方法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/06/17/ReactiveCocoa/ReactiveCocoa的bind方法/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="RAC的Bind方法">RAC的Bind方法</h1><p>RAC提供了一堆可以提高开发效率的方法,比如<code>filter</code>,<code>map</code>,<code>flattenMap</code>等值处理方法,几乎每个方法点到底,都能看到一个叫做<code>bind</code>的方法.这个方法就是RAC相对底层的方法.弄明白它,对于理解RAC是非常有帮助的.<br>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/06/17/ReactiveCocoa/ReactiveCocoa的bind方法/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/23/其他技术/Cocoapods打包framework:静态库的注意点/" itemprop="url">
                  Cocoapods打包framework/静态库的注意点
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-12-23T14:02:01+08:00" content="2016-12-23">
              2016-12-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/其他技术/" itemprop="url" rel="index">
                    <span itemprop="name">其他技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/12/23/其他技术/Cocoapods打包framework:静态库的注意点/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/12/23/其他技术/Cocoapods打包framework:静态库的注意点/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="背景">背景</h2><p>   关于使用Cocoapods打包静态库或者是Framework的文章,网上一搜一堆.可是当你读完,发现用处有限.它们的都是用最简单的场景串了一遍打包的流程,而整个过程中的多个坑,却根本没有提及.这就造成了一个假象,Cocoapods打包framework是简单愉快的,放弃原来的创建framework的形式吧!结果,当热情满满的开发者去用的时候,发现已经入了歧途了! </p>
<p>本人目前正在处理一款语音框架的工作,所以正好整理出来,希望能够对大家有帮助!</p>
<h2 id="Cocoapods流程">Cocoapods流程</h2><p>关于如何安装<code>Cocoapods</code>,在此就不赘述了.如果没有<code>Cocoapods</code>使用经验,也不建议看这篇文章. 另外,建议将<code>Cocoapods</code>升级到最新版本(包括最新的beta),升级命令如下:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem install cocoapods --pre</span><br></pre></td></tr></table></figure>
<h3 id="创建基本的工程结构">创建基本的工程结构</h3><ol>
<li><p>通过命令创建一个规范规程(这个很重要,方便你的开发与验证)</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pod lib create YouFrameworkName</span><br></pre></td></tr></table></figure>
</li>
<li><p>接下来就是一些问题,根据实际情况选择.(我这开发的OC版本)</p>
</li>
</ol>
<p><strong>特别说明: 一定要创建Demo Application!这个对你的开发有极大的帮助!!</strong></p>
<p>具体步骤也不赘述了,给大家几篇参考文章.做完就具备了基本的结构了.主要是想一块继续深入下去.</p>
<p><a href="http://www.cnblogs.com/brycezhang/p/4117180.html" target="_blank" rel="external">使用CocoaPods开发并打包静态库</a></p>
<p><a href="http://www.jianshu.com/p/0b516ee6576f" target="_blank" rel="external">一步一步教你使用CocoaPods打包静态库</a></p>
<h3 id="继续深入">继续深入</h3><p>有一个问题需要注意: <strong>如果你选择打包.a的静态库,那么cocoapods是不会给你生成头文件的</strong> ,这就意味着,其实,你只能打包framework.</p>
<p>按照上面的两篇文章做完,你会发现.握草,根本不够项目用啊.我项目还有三方的<code>framework</code>,还有三方的<code>.a</code>库,还想添加<code>pch</code>文件…</p>
<p>另外,关于各种路径的问题,例如:<code>s.source_files</code> 和<code>s.header_dir</code>这些,经常会被Cocoapods报错:pattern匹配不到任何文件.其实,只要记住一个原则:<strong>你的库路径(可能是线上git库也可能是本地git库)+你的指定路径 =  要找的文件路径</strong>,那么就一定没问题. 例如我的库路径是:<code>:git =&gt; &#39;/Users/kenny/Documents/LTVoiceAssistant&#39;</code> 而我指定的<code>s.source_files = &#39;LTVoiceAssistant/Classes/**/*.{c,h,hh,m,mm,cpp,a,pch}&#39;</code>,它们两个拼接,正好是我各种源码文件的路径.</p>
<h4 id="三方Framework和Library">三方Framework和Library</h4><p>在项目中,我们经常会有一些以文件形式存在的framework和.a,例如我项目中就有百度的语音识别和一个高德的.而由于某些原因,你不能用cocoapods将其管理,只能拖到项目中,cocoapods使用<code>vendored_frameworks</code>和<code>vendored_libraries</code>字段进行设置:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s.ios.vendored_libraries = 'LTVoiceAssistant/Classes/libBDVoiceRecognitionClient.a',</span><br><span class="line">                            'LTVoiceAssistant/Classes/libBDSSpeechSynthesizer.a'</span><br><span class="line"></span><br><span class="line">	s.ios.vendored_frameworks = 'LTVoiceAssistant/Classes/*.framework'</span><br></pre></td></tr></table></figure>
<h4 id="pch">pch</h4><p>如果你不是从零开始,而是将其他项目的代码剥离打包framework的话,这个绝对会帮你大忙,因为cocoapods的验证,会检查你代码的依赖性,如果有照不到的头文件或者引入关系不对,是通不过验证的.podspec中,提供了两种方式添加pch文件.<br>方法一 : 使用<code>s.prefix_header_contents</code>用法如下:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.prefix_header_contents = '#import "AHeader.h"','#import "BHeader.h"'</span><br></pre></td></tr></table></figure>
<p>可以看出,简单方便.但是也是因为简单,所以一些负责的宏之类的,你用这个是没法完成的.</p>
<p>方法二: 添加pch文件.<br>首先framework工程里(不是DemoApplication中)添加pch文件.然后将文件加入到编译的source中(如果你是拷贝进来的头文件)<br>最后,在podspec中,添加下面的信息:<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.prefix_header_file = 'LTVoiceAssistant/Classes/Global/LTSpeech-prefix.pch'</span><br></pre></td></tr></table></figure></p>
<p>在cocoapods的issue中,作者特别提到了.如果报找不到,那么是Xcode没找到,不是cocoapods,所以,确保将pch加入了编译.</p>
<h4 id="xib和storyboard">xib和storyboard</h4><p>如果你的代码中包含Xib和Storyboard,需要注意,这几个文件是需要添加到资源中的.<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s.resource = 'LTVoiceAssistant/Classes/Cells/*.xib'</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/28/研究随笔/用-Attribute-做点好玩的事情-第一篇/" itemprop="url">
                  用__Attribute__做点好玩的事情:第一篇
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-28T14:25:31+08:00" content="2016-09-28">
              2016-09-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/研究随笔/" itemprop="url" rel="index">
                    <span itemprop="name">研究随笔</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/28/研究随笔/用-Attribute-做点好玩的事情-第一篇/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/28/研究随笔/用-Attribute-做点好玩的事情-第一篇/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>之前写过一篇<a href="http://imguiqing.cc/2016/09/25/%E7%A0%94%E7%A9%B6%E9%9A%8F%E7%AC%94/attribute-constructor-%E7%94%A8%E6%B3%95%E6%8E%A2%E7%A9%B6/"><strong>attribute</strong>((constructor))用法探究</a>,当时是在看代码的时候,对它产生了偶遇.而这几天,越发发现这个<code>__attribute__</code>的强大.作为一个iOS开发者,我试着总结了一下这个在我们日常开发中的应用.<br>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/09/28/研究随笔/用-Attribute-做点好玩的事情-第一篇/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/27/研究随笔/OC中的对象下标索引/" itemprop="url">
                  OC中的对象下标索引
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-27T13:50:31+08:00" content="2016-09-27">
              2016-09-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/研究随笔/" itemprop="url" rel="index">
                    <span itemprop="name">研究随笔</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/27/研究随笔/OC中的对象下标索引/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/27/研究随笔/OC中的对象下标索引/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>相信对Swift有一定了解的人都知道它的下标语法.这个语法让类具备了像字典或者数组那样,利用下标获取一些东西的能力.但是,很多开发者或许不知道,OC中早就在Xcode4的时代,就已经有了这个语法.</p>
<h2 id="OC中的对象下标语法">OC中的对象下标语法</h2><p>正如数组和字典, OC中的下标也分为了索引和键位.<br>索引下标需要声明和实现这两个方法:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)objectAtIndexedSubscript:(<span class="built_in">NSUInteger</span>)idx;</span><br><span class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span>)obj atIndexedSubscript:(<span class="built_in">NSUInteger</span>)idx;</span><br></pre></td></tr></table></figure>
<p>键索引下标需要实现这两个方法:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>)objectForKeyedSubscript:(<span class="keyword">id</span> &lt;<span class="built_in">NSCopying</span>&gt;)key;</span><br><span class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span>)obj forKeyedSubscript:(<span class="keyword">id</span> &lt;<span class="built_in">NSCopying</span>&gt;)key;</span><br></pre></td></tr></table></figure>
<p>这么说还是有些抽象, 现在来具体看个例子:</p>
<h2 id="具体代码">具体代码</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BlackBox</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)objectAtIndexedSubscript:(<span class="built_in">NSUInteger</span>)idx;</span><br><span class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span>)obj atIndexedSubscript:(<span class="built_in">NSUInteger</span>)idx;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)objectForKeyedSubscript:(<span class="keyword">id</span> &lt;<span class="built_in">NSCopying</span>&gt;)key;</span><br><span class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span>)obj forKeyedSubscript:(<span class="keyword">id</span> &lt;<span class="built_in">NSCopying</span>&gt;)key;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)objectAtIndexedSubscript:(<span class="built_in">NSUInteger</span>)idx&#123;</span><br><span class="line">  <span class="comment">//做各种逻辑构造返回对象</span></span><br><span class="line">    <span class="keyword">return</span> @(idx);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span>)obj atIndexedSubscript:(<span class="built_in">NSUInteger</span>)idx&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)objectForKeyedSubscript:(<span class="keyword">id</span> &lt;<span class="built_in">NSCopying</span>&gt;)key&#123;</span><br><span class="line">    <span class="built_in">NSString</span> *condition = (<span class="built_in">NSString</span>*)key;</span><br><span class="line">    <span class="comment">//做各种逻辑构造返回对象</span></span><br><span class="line">    <span class="keyword">return</span> condition;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)setObject:(<span class="keyword">id</span>)obj forKeyedSubscript:(<span class="keyword">id</span> &lt;<span class="built_in">NSCopying</span>&gt;)key&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后使用方法:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BlackBox *blackBox = [BlackBox new];</span><br><span class="line"><span class="keyword">id</span> object1 = blackBox[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">id</span> object2 = blackBox[<span class="string">@"all objects where value &gt;= 100"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="使用场景">使用场景</h2><p>这个最好的感觉,就是封装细节.<br>现在比较火的路由,用这个方法去实现就比较好,例如:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">routes[<span class="string">@"black module://rootController:23"</span>] = ^(<span class="keyword">id</span> param)&#123;</span><br><span class="line">		<span class="comment">//逻辑代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="和方法的对比">和方法的对比</h2><p>然后这个用方法来实现,也是okay的啊,为啥要用这个下标呢? 个人感觉,本身,我们编程工作,很大一部分的内容就是命名.而这个命名也是很容易出问题的地方.而下标的方式,让我们可以省去这个步骤.很简单的一个例子:<br><code>array[10]</code> 和  <code>[array objectAtIndex:10]</code>你更愿意用哪个呢?</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/26/研究随笔/Protocolkit中宏的用法分析/" itemprop="url">
                  ProtocolKit中宏的用法分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-26T10:14:06+08:00" content="2016-09-26">
              2016-09-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/研究随笔/" itemprop="url" rel="index">
                    <span itemprop="name">研究随笔</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/26/研究随笔/Protocolkit中宏的用法分析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/26/研究随笔/Protocolkit中宏的用法分析/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>宏本身不难理解,但是往往嵌套多了,或者利用一些不常用的特性之后,会让人觉得迷惑.</p>
<h2 id="ProtocolKit中的一段宏定义">ProtocolKit中的一段宏定义</h2><p>在<code>ProtocolKit</code>中有这么一段宏的定义:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Get container class name by counter</span></span><br><span class="line"><span class="preprocessor">#define _pk_get_container_class($protocol) _pk_get_container_class_imp($protocol, __COUNTER__)</span></span><br><span class="line"><span class="preprocessor">#define _pk_get_container_class_imp($protocol, $counter) _pk_get_container_class_imp_concat(__PKContainer_, $protocol, $counter)</span></span><br><span class="line"><span class="preprocessor">#define _pk_get_container_class_imp_concat($a, $b, $c) $a ## $b ## _ ## $c</span></span><br></pre></td></tr></table></figure>
<p>当时知道:</p>
<p><code>##</code> 连字符,通常用来拼接</p>
<p><code>__COUNTER__</code>  计数器,一般用来后缀在变量上面,保证变量的唯一性.在程序中,每使用一次,这个数字就<code>+1</code>,默认是<code>0</code></p>
<p>再看实际拼接的结果:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">_pk_get_container_class(MyProtocol);</span><br><span class="line"><span class="comment">//相当于</span></span><br><span class="line">__PKContainer_MyProtocol_0;</span><br></pre></td></tr></table></figure>
<p>一开始的时候在想, 不就是要拼接么,为何要弄那么多层嵌套.难道是故意增加复杂度,让人觉得高深? 还有变量前面的<code>$</code>,是和shell中的一个意思? 表示变量?</p>
<h2 id="尝试简化">尝试简化</h2><p>遇到看不懂的东西,我喜欢先去掉,把自己知道的代码罗列出来.然后依次加上不懂得东西,看它对既有结果的改变.然后判断它的作用.<br>于是,我写了下面一个宏:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#define _kn_get_container_class(prefix,protocol) prefix##_##protocol##_##__COUNTER__</span></span><br></pre></td></tr></table></figure>
<p>然后使用:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> *  _kn_get_container_class(__kn,MyProtocol);</span><br></pre></td></tr></table></figure></p>
<p>可是根据编译器的警告来看,并不是我想要的结果:</p>
<p><img src="http://7xv9rf.com1.z0.glb.clouddn.com/20160926147485714436151.jpg?imageView2/0/format/jpg" alt="20160926147485714436151.jpg"></p>
<p>原来在<code>##</code>的作用下,<code>__COUNTER__</code>被当成了字面上的表示,并没有解析.<br>然后,根据作者的写法,把实现加深一层,改写为:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#define _simpleifyGetContainerClass(prefix,protocol,counter) _simple_getContainerClass_imp(prefix,protocol,counter)</span></span><br><span class="line"><span class="preprocessor">#define _simple_getContainerClass_imp(a,b,c) a##b##_##c</span></span><br></pre></td></tr></table></figure>
<p>调用</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSString</span> * _simpleifyGetContainerClass(__PKContainer_,MyProtocol,__COUNTER__);</span><br></pre></td></tr></table></figure>
<p><img src="http://7xv9rf.com1.z0.glb.clouddn.com/2016092614748581939059.jpg?imageView2/0/format/jpg" alt="2016092614748581939059.jpg"></p>
<p>发现结果正确.</p>
<p>我这种写法,需要使用者传递多个参数,也已经必须嵌套一层了.作者在此基础上加上默认的参数实现,也是很合理的.</p>
<p>另外可以看到,这个<code>$</code>符号,不加也可以,所以,个人猜想.这个和shell中<code>使用变量</code>不是一回事.可能加上仅仅为了阅读者明白,这个地方是个变量.若理解不正确,请您指正.</p>
<h2 id="GCC中一个可变参数的宏">GCC中一个可变参数的宏</h2><p>之前项目中,封装过打印.当时就用到了可变参数的宏:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="preprocessor">#define GUIError(message,...) DDLogError(@<span class="title">"\n[   FILE  ]  %s \n[  METHOD ]  %s\n[   LINE  ] %d \n[ Message ]\n%@\n\n=======================================================\n"</span>,__FILE__,__FUNCTION__,__LINE__,[NSString stringWithFormat:message,## __VA_ARGS__])</span></span><br></pre></td></tr></table></figure>
<p>就是在定义的时候,以<code>...</code>作为最后一个参数,使用的时候,<code>__VA_ARGS__</code>就代指这一系列可变参数.</p>
<p>今天想找找关于宏的资料,发现GCC的文档中,也有关于可变参数宏的说明.在此,就不赘述了,想深入了解的,可以<a href="https://gcc.gnu.org/onlinedocs/gcc-6.2.0/gcc/Variadic-Macros.html#Variadic-Macros" target="_blank" rel="external">查看文档</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/研究随笔/attribute-constructor-用法探究/" itemprop="url">
                  __attribute__((constructor))用法探究
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-25T19:54:37+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/研究随笔/" itemprop="url" rel="index">
                    <span itemprop="name">研究随笔</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/25/研究随笔/attribute-constructor-用法探究/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/25/研究随笔/attribute-constructor-用法探究/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>今天在看ProtocolKit的源码,看到了这么一行代码.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__attribute__((constructor)) <span class="keyword">static</span> <span class="keyword">void</span> _pk_extension_inject_entry(<span class="keyword">void</span>) &#123;</span><br></pre></td></tr></table></figure>
<p>主要造成疑惑的是 <code>__attribute__((constructor))</code>,以前看过关于<code>__attribute__</code>这个关键字的,大概还记得就是可以修饰类型,函数什么的.类似一个编译标记.但是具体用法忘记了.</p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2016/09/25/研究随笔/attribute-constructor-用法探究/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="桂庆" />
          <p class="site-author-name" itemprop="name">桂庆</p>
          <p class="site-description motion-element" itemprop="description">Kenny 肉桂的主页 记录自己的进步</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">75</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/2655284735/profile?rightmod=1&wvr=6&mod=personnumber&is_all=1" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">桂庆</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"imguiqing"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
